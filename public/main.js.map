{"version":3,"file":"main.js","sources":["../source/main.js","../source/config.js","../source/utils.js","../source/Views/Story.js","../source/Views/User.js","../source/Views/Comments.js"],"sourcesContent":["var root = document.getElementById('container')\nvar _l = console.log.bind(console) // eslint-disable-line no-console\n\nredirToHttps()\nregisterSW()\nnavActive()\n\nimport Story from './Views/Story.js'\nimport User from './Views/User.js'\nimport Comments from './Views/Comments.js'\n\nexport default {\n  router: m.route(root, '/', {\n    '/'  : Story('news'),\n    '/news/:page'  : Story('news'),\n    '/newest/:page': Story('newest'),\n    '/ask/:page'   : Story('ask'),\n    '/show/:page'  : Story('show'),\n    '/jobs/:page'  : Story('jobs'),\n    '/user/:user'  : User,\n    '/comm/:item'  : Comments,\n  })\n}\n\nsetStyles()\n\nfunction registerSW() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', function() {\n      navigator.serviceWorker.register('sw.js').then(function(registration) {\n        // Registration was successful\n        _l('ServiceWorker registration successful with scope: ', registration.scope)\n      }, function(err) {\n        // registration failed :(\n        _l('ServiceWorker registration failed: ', err)\n      })\n    })\n  }\n}\n\nfunction redirToHttps() {\n  var host = location.hostname\n  if (host == 'localhost' || host.match(/\\.localhost$/)) {\n    return 0\n  }\n  if (location.protocol == 'https:') {\n    return 0\n  }\n  var href = location.href.replace(/^http:/, 'https:')\n  location.href = href\n}\n\nfunction navActive() {\n  var nav = document.getElementById('navigation')\n  var items = nav.querySelectorAll('.tab-item')\n  nav.addEventListener('click', navActiveToggle.bind(items))\n  var link = location.hash.substr(3).replace(/\\/.*/, '')\n  if (link == '') {\n    link = 'news'\n  }\n  var actual = nav.querySelector('a[data-link=' + link + ']')\n  navActiveToggle.call(items, {target: actual})\n}\n\nfunction navActiveToggle(ev) {\n  for (var i = 0, l = this.length; i < l; i++) {\n    rmClass(this[i], 'active')\n  }\n  var target = ev.target\n  if (!target) {\n    return\n  }\n  var tag = target.tagName.toLowerCase()\n  if (tag == 'a') {\n    adClass(target.parentNode, 'active')\n  }\n}\n\nfunction adClass(el, clas) {\n  var actual = el.className.trim()\n  if (actual == '') {\n    el.className = clas\n    return 1\n  }\n  if (actual == clas) {\n    return 0\n  }\n  if (actual.indexOf(' ' + clas) >= 0 || actual.indexOf(clas + ' ') >= 0) {\n    return 0\n  }\n  el.className += ' ' + clas\n  return 1\n}\n\nfunction rmClass(el, clas) {\n  var actual = el.className.trim()\n  if (actual == '') {\n    return 0\n  }\n  if (actual == clas) {\n    el.className = ''\n    return 0\n  }\n  var t = ' ' + clas\n  if (actual.indexOf(t) >= 0) {\n    el.className = el.className.replace(t, '')\n    return 1\n  }\n  t = clas + ' '\n  if (actual.indexOf(t) >= 0) {\n    el.className = el.className.replace(t, '')\n    return 1\n  }\n  return 0\n}\n\nfunction setStyles() {\n  var s = document.createElement('link')\n  s.rel = 'stylesheet'\n  s.href = 'https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.2.14/spectre.min.css'\n  document.querySelector('head').appendChild(s)\n}\n","export default {\n  base: 'https://api.hackerwebapp.com/'\n}\n","export default {\n  items2dom: items2dom\n}\n\nfunction items2dom(items) {\n  var ret = []\n  // use the for young padawan to go faster\n  for (var i = 0, l = items.length; i < l; i++) {\n    var item = items[i]\n    var comm = '#!/comments/' + item.id\n    var title = item.title\n    if (item.domain) {\n      title += ' (' + item.domain + ')'\n    }\n    var points = m('span.badge[data-badge=' + item.points + ']', 'Points')\n    if (item.points === null) {\n      points = ''\n    }\n    var st = [\n      m('h5',\n        m('a[href=' + item.url + '][target=_blank][rel=noopener]', title)),\n      m('.columns', [\n        m('.column.col-3', points),\n        m('.column.col-3',\n          m('span.badge[data-badge=' + item.comments_count + ']', m('a[href=' + comm + ']', 'Comments'))),\n        m('.column.col-3',\n          // m('span.user', m('a[href=#!/user/' + item.user + ']', 'by ' + item.user))),\n          m('span.user', 'by ' + item.user)),\n        m('.column.col-3',\n          m('span.time', item.time_ago)),\n      ]),\n      m('.divider')\n    ]\n    ret.push(st)\n  }\n  return ret\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default function (type) {\n  return {\n    loading: true,\n    items: [],\n    oninit: function () {\n      this.loading = true\n      var page = m.route.param('page') || 1\n      var url = config.base + type + '?page=' + page\n      var self = this\n      m.request(url)\n      .then(function (items) {\n        self.items = items\n        self.loading = false\n      })\n    },\n    view: function () {\n      if (this.loading) {\n        return m('.loading')\n      }\n      return u.items2dom(this.items)\n    }\n  }\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default  {\n  loading: true,\n  items: [],\n  oninit: function () {\n    this.loading = true\n    var user = m.route.param('user')\n    var url = config.base + 'user/' + user\n    var self = this\n    m.request(url)\n    .then(function (items) {\n      self.items = items\n      self.loading = false\n    })\n  },\n  view: function () {\n    if (this.loading) {\n      return m('.loading')\n    }\n    return u.items2dom(this.items)\n  }\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default  {\n  loading: true,\n  items: [],\n  oninit: function () {\n    this.loading = true\n    var user = m.route.param('user')\n    var url = config.base + 'user/' + user\n    var self = this\n    m.request(url)\n    .then(function (items) {\n      self.items = items\n      self.loading = false\n    })\n  },\n  view: function () {\n    if (this.loading) {\n      return m('.loading')\n    }\n    return u.items2dom(this.items)\n  }\n}\n"],"names":["navActiveToggle","ev","i","l","this","length","rmClass","target","tagName","toLowerCase","adClass","parentNode","el","clas","actual","className","trim","indexOf","t","replace","base","items2dom","items","ret","item","comm","id","title","domain","points","m","st","url","comments_count","user","time_ago","push","type","loading","oninit","page","route","param","config","self","request","then","view","u","root","document","getElementById","_l","console","log","bind","host","location","hostname","match","protocol","href","navigator","window","addEventListener","serviceWorker","register","registration","scope","err","nav","querySelectorAll","link","hash","substr","querySelector","call","router","/","Story","/news/:page","/newest/:page","/ask/:page","/show/:page","/jobs/:page","/user/:user","User","/comm/:item","Comments","s","createElement","rel","appendChild"],"mappings":"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"}