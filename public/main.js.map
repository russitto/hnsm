{"version":3,"file":"main.js","sources":["../source/utils.js","../source/main.js","../source/config.js","../source/Views/Story.js","../source/Views/User.js","../source/Views/Item.js"],"sourcesContent":["var log = console.log.bind(console) // eslint-disable-line no-console\n\nexport default {\n  items2dom: items2dom,\n  comms2dom: comms2dom,\n  adClass: adClass,\n  rmClass: rmClass,\n  log: log\n}\n\nfunction items2dom(items) {\n  var ret = []\n  // use the for young padawan to go faster\n  for (var i = 0, l = items.length; i < l; i++) {\n    var item = items[i]\n    var title = item.title\n    if (item.domain) {\n      title += ' (' + item.domain + ')'\n    }\n\n    var subline = []\n    if (item.points !== null) {\n      subline.push(m('span.badge[data-badge=' + item.points + ']', 'Points'))\n    }\n    subline.push(m('span.badge[data-badge=' + item.comments_count + ']',\n      m('a[href=#!/item/' + item.id + ']', 'Comments')))\n    if (item.user) {\n      subline.push(m('span.user', m('a[href=#!/user/' + item.user + ']', 'by ' + item.user)))\n    }\n    subline.push(m('span.time', item.time_ago))\n    var columns = []\n    for (var j = 0, ll = subline.length; j < ll; j++) {\n      columns.push(m('.column.col-' + (12/ll), subline[j]))\n    }\n\n    var st = m('.news-item', [\n      m('h5',\n        m('a[href=' + item.url + '][target=_blank][rel=noopener]', title)),\n      m('.columns', columns),\n      m('.divider')\n    ])\n    ret.push(st)\n  }\n  return ret\n}\n\nfunction comms2dom(comms) {\n  var ret = []\n  // use the for young padawan to go faster\n  for (var i = 0, l = comms.length; i < l; i++) {\n    var comm = comms[i]\n    var content = comm.content\n    var elDom = [\n      m.trust(content),\n      m('.stats', comm.time_ago + ' by ' + comm.user)\n    ]\n    if (comm.comments.length) {\n      elDom.push(comms2dom(comm.comments))\n    }\n    if (comm.level == 0) {\n      elDom.push(m('.divider'))\n    }\n    ret.push(m('.comment[style=margin-left: ' + (comm.level*2) + 'rem]', elDom))\n  }\n  return ret\n}\n\nfunction adClass(el, clas) {\n  var actual = el.className.trim()\n  if (actual == '') {\n    el.className = clas\n    return 1\n  }\n  if (actual == clas) {\n    return 0\n  }\n  if (actual.indexOf(' ' + clas) >= 0 || actual.indexOf(clas + ' ') >= 0) {\n    return 0\n  }\n  el.className += ' ' + clas\n  return 1\n}\n\nfunction rmClass(el, clas) {\n  var actual = el.className.trim()\n  if (actual == '') {\n    return 0\n  }\n  if (actual == clas) {\n    el.className = ''\n    return 0\n  }\n  var t = ' ' + clas\n  if (actual.indexOf(t) >= 0) {\n    el.className = el.className.replace(t, '')\n    return 1\n  }\n  t = clas + ' '\n  if (actual.indexOf(t) >= 0) {\n    el.className = el.className.replace(t, '')\n    return 1\n  }\n  return 0\n}\n","var root = document.getElementById('container')\nredirToHttps()\nregisterSW()\nnavActive()\n\nimport Story from './Views/Story.js'\nimport User from './Views/User.js'\nimport Item from './Views/Item.js'\nimport u from './utils.js'\n\nexport default {\n  router: m.route(root, '/', {\n    '/'  : Story('news'),\n    '/news/:page'  : Story('news'),\n    '/newest/:page': Story('newest'),\n    '/ask/:page'   : Story('ask'),\n    '/show/:page'  : Story('show'),\n    '/jobs/:page'  : Story('jobs'),\n    '/user/:user'  : User,\n    '/item/:id'    : Item\n  })\n}\n\nsetStyles()\n\nfunction registerSW() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', function() {\n      navigator.serviceWorker.register('sw.js').then(function(registration) {\n        // Registration was successful\n        u.log('ServiceWorker registration successful with scope: ', registration.scope)\n      }, function(err) {\n        // registration failed :(\n        u.log('ServiceWorker registration failed: ', err)\n      })\n    })\n  }\n}\n\nfunction redirToHttps() {\n  var host = location.hostname\n  if (host == 'localhost' || host.match(/\\.localhost$/)) {\n    return 0\n  }\n  if (location.protocol == 'https:') {\n    return 0\n  }\n  var href = location.href.replace(/^http:/, 'https:')\n  location.href = href\n}\n\nfunction navActive() {\n  var nav = document.getElementById('navigation')\n  var items = nav.querySelectorAll('.tab-item')\n  nav.addEventListener('click', navActiveToggle.bind(items))\n  var link = location.hash.substr(3).replace(/\\/.*/, '')\n  if (link == '') {\n    link = 'news'\n  }\n  var actual = nav.querySelector('a[data-link=' + link + ']')\n  navActiveToggle.call(items, {target: actual})\n}\n\nfunction navActiveToggle(ev) {\n  for (var i = 0, l = this.length; i < l; i++) {\n    u.rmClass(this[i], 'active')\n  }\n  var target = ev.target\n  if (!target) {\n    return\n  }\n  var tag = target.tagName.toLowerCase()\n  if (tag == 'a') {\n    u.adClass(target.parentNode, 'active')\n  }\n}\n\nfunction setStyles() {\n  var s = document.createElement('link')\n  s.rel = 'stylesheet'\n  // s.href = 'https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.2.14/spectre.min.css'\n  s.href = 'ext/spectre.css'\n  document.querySelector('head').appendChild(s)\n}\n","export default {\n  base: 'https://api.hackerwebapp.com/'\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default function (type) {\n  return {\n    loading: true,\n    items: [],\n    oninit: function () {\n      this.loading = true\n      var page = m.route.param('page') || 1\n      var url = config.base + type + '?page=' + page\n      var self = this\n      m.request(url)\n      .then(function (items) {\n        self.items = items\n        self.loading = false\n      })\n    },\n    view: function () {\n      if (this.loading) {\n        return m('.loading')\n      }\n      return u.items2dom(this.items)\n    }\n  }\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default  {\n  loading: true,\n  user: false,\n  oninit: function () {\n    this.loading = true\n    var user = m.route.param('user')\n    var url = config.base + 'user/' + user\n    var self = this\n    m.request(url)\n    .then(function (user) {\n      self.user = user\n      self.loading = false\n    })\n  },\n  view: function () {\n    if (this.loading) {\n      return m('.loading')\n    }\n    u.log(this.user)\n    return [\n      m('h4', this.user.id),\n      m('.karma', 'karma: ' + this.user.karma),\n      m('.time', 'created: ' + this.user.created),\n      m.trust(this.user.about)\n    ]\n  }\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default {\n  loading: true,\n  item: false,\n  oninit: function () {\n    this.loading = true\n    var id = m.route.param('id')\n    var url = config.base + 'item/' + id\n    var self = this\n    m.request(url)\n    .then(function (it) {\n      self.item = it\n      self.loading = false\n    })\n  },\n  view: function () {\n    if (this.loading) {\n      return m('.loading')\n    }\n    var elDom = [\n      m('h4', this.item.title),\n    ]\n    if (this.item.url.indexOf('item?') != 0) {\n      elDom.push(m('.url', m('a[rel=noopener][target=_blank][href=' + this.item.url + ']', this.item.url)))\n    }\n    elDom.push(m('.stats', this.item.time_ago + ' by ' + this.item.user))\n    elDom.push(m('h5', 'Comments'))\n    elDom.push(u.comms2dom(this.item.comments))\n    return elDom\n  }\n}\n\n"],"names":["comms2dom","comms","ret","i","l","length","comm","content","elDom","m","trust","time_ago","user","comments","push","level","navActiveToggle","ev","this","u","rmClass","target","tagName","toLowerCase","adClass","parentNode","base","items2dom","items","item","title","domain","subline","points","comments_count","id","columns","j","ll","st","url","el","clas","actual","className","trim","indexOf","t","replace","log","console","bind","type","loading","oninit","page","route","param","config","self","request","then","view","karma","created","about","it","root","document","getElementById","host","location","hostname","match","protocol","href","navigator","window","addEventListener","serviceWorker","register","registration","scope","err","nav","querySelectorAll","link","hash","substr","querySelector","call","router","/","Story","/news/:page","/newest/:page","/ask/:page","/show/:page","/jobs/:page","/user/:user","User","/item/:id","Item","s","createElement","rel","appendChild"],"mappings":"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"}