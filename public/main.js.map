{"version":3,"file":"main.js","sources":["../source/utils.js","../source/main.js","../source/config.js","../source/Views/Story.js","../source/Views/User.js","../source/Views/Item.js"],"sourcesContent":["var log = console.log.bind(console) // eslint-disable-line no-console\n\nexport default {\n  items2dom: items2dom,\n  comms2dom: comms2dom,\n  adClass: adClass,\n  rmClass: rmClass,\n  request: request,\n  log: log\n}\n\nfunction items2dom(items) {\n  var ret = []\n  // use the for young padawan to go faster\n  for (var i = 0, l = items.length; i < l; i++) {\n    var item = items[i]\n    var title = item.title\n    if (item.domain) {\n      title += ' (' + item.domain + ')'\n    }\n\n    var subline = []\n    if (item.points !== null) {\n      subline.push(m('span.badge[data-badge=' + item.points + ']', 'Points'))\n    }\n    subline.push(m('span.badge[data-badge=' + item.comments_count + ']',\n      m('a[href=#!/item/' + item.id + ']', 'Comments')))\n    if (item.user) {\n      subline.push(m('span.user', m('a[href=#!/user/' + item.user + ']', 'by ' + item.user)))\n    }\n    subline.push(m('span.time', item.time_ago))\n    var columns = []\n    for (var j = 0, ll = subline.length; j < ll; j++) {\n      columns.push(m('.text-center.column.col-' + (12/ll), subline[j]))\n    }\n\n    var st = m('.news-item', [\n      m('h5',\n        m('a[href=' + item.url + '][target=_blank][rel=noopener]', title)),\n      m('.columns', columns),\n      m('.divider')\n    ])\n    ret.push(st)\n  }\n  return ret\n}\n\nfunction comms2dom(comms) {\n  var ret = []\n  // use the for young padawan to go faster\n  for (var i = 0, l = comms.length; i < l; i++) {\n    var comm = comms[i]\n    var content = comm.content\n    var elDom = [\n      m.trust(content),\n      m('.stats', comm.time_ago + ' by ' + comm.user)\n    ]\n    if (comm.comments.length) {\n      elDom.push(comms2dom(comm.comments))\n    }\n    if (comm.level == 0) {\n      elDom.push(m('.divider'))\n    }\n    ret.push(m('.comment[style=margin-left: ' + (comm.level*2) + 'rem]', elDom))\n  }\n  return ret\n}\n\nfunction adClass(el, clas) {\n  var actual = el.className.trim()\n  if (actual == '') {\n    el.className = clas\n    return 1\n  }\n  if (actual == clas) {\n    return 0\n  }\n  if (actual.indexOf(' ' + clas) >= 0 || actual.indexOf(clas + ' ') >= 0) {\n    return 0\n  }\n  el.className += ' ' + clas\n  return 1\n}\n\nfunction rmClass(el, clas) {\n  var actual = el.className.trim()\n  if (actual == '') {\n    return 0\n  }\n  if (actual == clas) {\n    el.className = ''\n    return 0\n  }\n  var t = ' ' + clas\n  if (actual.indexOf(t) >= 0) {\n    el.className = el.className.replace(t, '')\n    return 1\n  }\n  t = clas + ' '\n  if (actual.indexOf(t) >= 0) {\n    el.className = el.className.replace(t, '')\n    return 1\n  }\n  return 0\n}\n\nvar cachePrefix = 'hnsm-'\n\nfunction request(url) {\n  var getCached = true\n  if ((typeof url).toLowerCase() == 'object') {\n    if ('cache' in url) {\n      getCached = url.cache\n    }\n    url = url.url\n  }\n  var cache\n  var st = sessionStorage \n  if (st && getCached) {\n    cache = st.getItem(cachePrefix + url)\n    if (cache) {\n      try {\n        var data = JSON.parse(cache)\n        log('cache', data)\n        return new Promise(function (resolve) {\n          resolve(data)\n        })\n      } catch (e) {\n        log(e)\n      }\n    }\n  }\n  return m.request(url)\n  .then(function (data) {\n    if (st) {\n      st.setItem(cachePrefix + url, JSON.stringify(data))\n    }\n    return data\n  })\n}\n","var root = document.getElementById('container')\nredirToHttps()\nregisterSW()\nnavActive()\n\nimport Story from './Views/Story.js'\nimport User from './Views/User.js'\nimport Item from './Views/Item.js'\nimport u from './utils.js'\n\nexport default {\n  router: m.route(root, '/', {\n    '/'  : Story('news'),\n    '/news/:page'  : Story('news'),\n    '/newest/:page': Story('newest'),\n    '/ask/:page'   : Story('ask'),\n    '/show/:page'  : Story('show'),\n    '/jobs/:page'  : Story('jobs'),\n    '/user/:user'  : User,\n    '/item/:id'    : Item\n  })\n}\n\n// setStyles()\n\nfunction registerSW() {\n  if ('serviceWorker' in navigator) {\n    window.addEventListener('load', function() {\n      navigator.serviceWorker.register('sw.js').then(function(registration) {\n        // Registration was successful\n        u.log('ServiceWorker registration successful with scope: ', registration.scope)\n      }, function(err) {\n        // registration failed :(\n        u.log('ServiceWorker registration failed: ', err)\n      })\n    })\n  }\n}\n\nfunction redirToHttps() {\n  var host = location.hostname\n  if (host == 'localhost' || host.match(/\\.localhost$/)) {\n    return 0\n  }\n  if (location.protocol == 'https:') {\n    return 0\n  }\n  var href = location.href.replace(/^http:/, 'https:')\n  location.href = href\n}\n\nfunction navActive() {\n  var nav = document.getElementById('navigation')\n  nav.style.marginTop = 0\n  var theme = document.querySelector('head meta[name=theme-color]')\n  var tColor\n  if (theme) {\n    tColor = theme.getAttribute('content')\n    if (tColor) {\n      nav.style.backgroundColor = tColor\n    }\n  }\n\n  var items = nav.querySelectorAll('.tab-item')\n  nav.addEventListener('click', navActiveToggle.bind(items))\n  var link = location.hash.substr(3).replace(/\\/.*/, '')\n  if (link == '') {\n    link = 'news'\n  }\n  var actual = nav.querySelector('a[data-link=' + link + ']')\n  navActiveToggle.call(items, {target: actual})\n}\n\nfunction navActiveToggle(ev) {\n  for (var i = 0, l = this.length; i < l; i++) {\n    u.rmClass(this[i], 'active')\n  }\n  var target = ev.target\n  if (!target) {\n    return\n  }\n  var tag = target.tagName.toLowerCase()\n  if (tag == 'a') {\n    u.adClass(target.parentNode, 'active')\n  }\n}\n\nfunction setStyles() {\n  var s = document.createElement('link')\n  s.rel = 'stylesheet'\n  // s.href = 'https://cdnjs.cloudflare.com/ajax/libs/spectre.css/0.2.14/spectre.min.css'\n  s.href = 'ext/spectre.css'\n  document.querySelector('head').appendChild(s)\n}\n","export default {\n  base: 'https://api.hackerwebapp.com/'\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default function (type) {\n  return {\n    loading: true,\n    items: [],\n    oninit: function () {\n      this.loading = true\n      var page = m.route.param('page') || 1\n      var url = config.base + type + '?page=' + page\n      var self = this\n      u.request(url)\n      .then(function (items) {\n        // u.log('story view', items)\n        self.items = items\n        self.loading = false\n        m.redraw()\n      })\n    },\n    view: function () {\n      if (this.loading) {\n        return m('.loading')\n      }\n      return u.items2dom(this.items)\n    }\n  }\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default  {\n  loading: true,\n  user: false,\n  oninit: function () {\n    this.loading = true\n    var user = m.route.param('user')\n    var url = config.base + 'user/' + user\n    var self = this\n    u.request(url)\n    .then(function (user) {\n      self.user = user\n      self.loading = false\n    })\n  },\n  view: function () {\n    if (this.loading) {\n      return m('.loading')\n    }\n    u.log(this.user)\n    return [\n      m('h4', this.user.id),\n      m('.karma', 'karma: ' + this.user.karma),\n      m('.time', 'created: ' + this.user.created),\n      m.trust(this.user.about)\n    ]\n  }\n}\n","import config from '../config.js'\nimport u from '../utils.js'\n\nexport default {\n  loading: true,\n  item: false,\n  oninit: function () {\n    this.loading = true\n    var id = m.route.param('id')\n    var url = config.base + 'item/' + id\n    var self = this\n    u.request({url: url, cache: false})\n    .then(function (it) {\n      self.item = it\n      self.loading = false\n    })\n  },\n  view: function () {\n    if (this.loading) {\n      return m('.loading')\n    }\n    var elDom = [\n      m('h4', this.item.title),\n    ]\n    if (this.item.url.indexOf('item?') != 0) {\n      elDom.push(m('.url', m('a[rel=noopener][target=_blank][href=' + this.item.url + ']', this.item.url)))\n    }\n    elDom.push(m('.stats', this.item.time_ago + ' by ' + this.item.user))\n    elDom.push(m('h5', 'Comments'))\n    elDom.push(u.comms2dom(this.item.comments))\n    return elDom\n  }\n}\n\n"],"names":["comms2dom","comms","ret","i","l","length","comm","content","elDom","m","trust","time_ago","user","comments","push","level","navActiveToggle","ev","this","u","rmClass","target","tagName","toLowerCase","adClass","parentNode","base","log","console","bind","items2dom","items","item","title","domain","subline","points","comments_count","id","columns","j","ll","st","url","el","clas","actual","className","trim","indexOf","t","replace","request","getCached","cache","sessionStorage","getItem","cachePrefix","data","JSON","parse","Promise","resolve","e","then","setItem","stringify","type","loading","oninit","page","route","param","config","self","redraw","view","karma","created","about","it","root","document","getElementById","host","location","hostname","match","protocol","href","navigator","window","addEventListener","serviceWorker","register","registration","scope","err","nav","style","marginTop","tColor","theme","querySelector","getAttribute","backgroundColor","querySelectorAll","link","hash","substr","call","router","/","Story","/news/:page","/newest/:page","/ask/:page","/show/:page","/jobs/:page","/user/:user","User","/item/:id","Item"],"mappings":"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"}